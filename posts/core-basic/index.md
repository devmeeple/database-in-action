# 김영한의 실전 데이터베이스 - 기본편

## 1.5 MySQL 설치 안내

- MySQL Community Server 8.0, Workbench
- Docker

## 2.1 실습 데이터 준비

- `CREATE DATABASE IF NOT EXISTS [table]`: 데이터베이스가 존재하지 않으면 생성
- `DROP TABLE IF EXISTS [table]`: 테이블이 존재하면 삭제
- `BIGINT`를 사용하는 이유: 서비스가 성장하면 데이터가 기하급수적으로 증가한다. 따라서 `INT`형이 아닌 `BIGINT`를 사용한다.

## 2.2 조인이 필요한 이유

- 데이터 중복(Redundancy)
- 갱신 이상(Update Anomaly)
- 삽입 이상(Insertion Anomaly)
- 삭제 이상(Deletion Anomaly)

- **문제를 해결하기 위해 정규화(Normalization)를 사용한다.** 정규화는 데이터의 중복을 최소화하고, 일관성을 유지하기 위해 논리적인 단위로 분리하는 과정이다.
- 분리한 데이터를 다시 연결하는 기술이 조인(JOIN)이다. 조인은 두 개 이상의 테이블을 특정 컬럼을 기준으로 연결하여 마치 하나의 테이블이었던 것처럼 보여주는 기술이다. 보통 기본키(Primary Key)와
  외래키(Foreign Key)를 사용한다.

## 2.3 내부 조인 1

```sql
SELECT 컬럼1,
       컬럼2, ...
    FROM 테이블A
    INNER JOIN 테이블11B
ON 테이블A.연결컬럼 = 테이블B.연결컬럼;
```

- 조인은 내부 조인(INNER JOIN)과 외부 조인(OUTER JOIN)으로 나눠진다.
- 내부 조인은 두 테이블을 연결할 때, **양쪽 테이블에서 모두 공통으로 존재하는 데이터만 결과로 출력한다.**
- 내부 조인에서 `INNER`는 생략할 수 있다. `INNER`없이 `JOIN`만 작성하면 `INNER JOIN`으로 동작한다.
- 실무에서는 어떤 테이블의 필드인지 명시하기를 권장한다. 가독성을 높이고, 컬럼의 소속을 쉽게 인지할 수 있다. 주로 테이블 별칭과 함께 사용한다.
- **논리적 처리 순서**
    - `FROM` / `JOIN`: 만족하는 가상 테이블을 생성(테이블 결합)
    - `WHERE`: 조건을 만족하는 행을 필터링(조건 필터링)
    - `SELECT`: 컬럼 선택

> **쿼리 옵티마이저(Query Optimizer)**
>
> - 사용자와 데이터베이스 간 논리적 순서는 일종의 약속이다. 하지만 쿼리 옵티마이저는 쿼리를 더욱 효율적인 방식으로 실행한다.
> - 실제 물리적인 실행 순서는 달라질 수 있지만 어떻게 작동하든 최종 결과는 논리적인 순서와 동일하다.

## 2.4 내부 조인 2

### 조인과 집합

- 내부 조인은 '집합' 관점에서 바라봤을 때 쉽게 이해할 수 있다.
- 내부 조인은 벤 다이어그램에서 둘의 겹친 영역, 교집합 영역을 의미한다.
- 한쪽에만 존재하는 데이터는 결과에 포함되지 않고, 양쪽 모두 명확하게 연결된 데이터만 짝지어 보여준다.
- 내부 조인은 양방향이다. A -> B로 조인할 수 있다면 B -> A로 조인할 수 있다. 결과는 항상 동일하다.

## 2.5 내부 조인 3

- 내부 조인은 어떤 순서로 작성해도 결과는 동일하다. 하지만 쿼리를 읽을 때 중심이 되는 데이터를 기준으로 작성하면 가독성이 높아진다.
    - `OUTER JOIN`은 조인 순서가 결과에 매우 큰 영향을 미친다.
- 테이블 별칭(Alias)을 사용할 때 테이블 별칭은 `AS` 키워드를 생략하고 컬럼 별칭은 `AS` 키워드를 사용한다.

## 2.6 정리

### 조인이 필요한 이유

- 데이터는 정규화 과정을 통해 여러 테이블에 나뉘어 저장된다.
- 데이터의 중복을 피하고 데이터 갱신, 삽입, 삭제 시 발생할 수 있는 이상 현상을 방지하기 위함이다.
- 분리된 테이블에서 의미 있는 정보를 얻으려면 흩어진 데이터를 다시 연결해야 한다.
- 조인은 여러 테이블에 흩어진 데이터를 기본키와 외래키를 기준으로 합쳐 보여주는 핵심 기술이다.

### 내부 조인

- 내부 조인(INNER JOIN)은 두 테이블에 공통으로 존재하는 데이터만 결과로 출력한다.
- `ON`절에 명시된 연결 조건이 참이 되는 행들만 결과에 포함한다.
- 조인의 논리적 처리 순서는 `FROM/JOIN`으로 테이블을 결합, `WHERE`로 조건 필터링, `SELECT`로 컬럼을 선택하는 순서로 진행된다.
- 내부 조인에서 `INNER` 키워드는 생략 가능하다.
- 내부 조인은 집합 관점에서 교집합을 의미한다.
- 테이블 별칭(Alias)을 사용하면 쿼리의 가독성을 높이고 간결한 작성이 가능하다.
- 실무에서는 보통 테이블 별칭의 `AS`는 생략하고 컬럼 별칭의 `AS`는 명시적으로 사용한다.
- 내부 조인은 순서에 상관없이 결과가 같지만 외부 조인은 순서가 결과에 큰 영향을 미친다.

## 3.1 외부 조인 1

- 실무에서는 종종 짝이 없는, 소외된 데이터를 찾아야 할 때가 있다.
- 외부 조인(OUTER JOIN)은 한쪽에는 데이터가 있지만, 다른 한쪽에는 없는 데이터까지 결과에 모두 포함시킨다.
    - 외부 조인은 교집합 밖(OUTER)의 영역을 포함한다는 의미다.
- 기준이 되는 테이블이 어느 쪽이냐에 따라 `LEFT OUTER JOIN`과 `RIGHT OUTER JOIN`으로 나뉜다.
    - 양쪽 모두를 함께 포함하는 풀 외부 조인(FULL OUTER JOIN)도 있다. 하지만 실무에서 자주 사용하지 않고, MySQL은 지원하지 않는다.
- **외부 조인의 핵심은 기준 테이블이다.** `LEFT OUTER JOIN`은 왼쪽 테이블을, `RIGHT OUTER JOIN`은 오른쪽 테이블을 기준으로 삼는다.
- `OUTER`는 생략 가능하다.
    - `LEFT OUTER JOIN` -> `LEFT JOIN`
    - `RIGHT OUTER JOIN` -> `RIGHT JOIN`
- `OUTER JOIN`은 기준 테이블의 데이터를 모두 포함한다. 조인 대상이 없는 데이터는 모두 `NULL`로 표시한다.
    - `NULL`은 '값이 없음'을 나타내는 특별한 상태이므로, `=`연산자로 비교할 수 없다. 반드시 `IS NULL`또는 `IS NOT NULL`을 사용해야 한다.

## 3.2 외부 조인 2

- 실무에서는 주로 `LEFT JOIN`을 사용한다. 기준이 되는 테이블을 `FROM`절에 먼저 쓰고, 필요한 정보를 담은 다른 테이블을 `LEFT JOIN`으로 하나씩 붙여가는 방식으로 쿼리를 작성하는 것이 직관적이기 때문이다.